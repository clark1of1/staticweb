<!-- saved from url=(0026)http://127.0.0.1:8000/game -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BSIT3B | GROUP2</title>

  <!-- Tailwind CSS -->
  <link href="./game_files/tailwind.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="./game_files/css2" rel="stylesheet">

  <!-- AOS Animation Library -->
  <link href="./game_files/aos.css" rel="stylesheet">
  <script src="./game_files/aos.js.download"></script>

  <style>
    html { scroll-behavior: smooth; }
    body { 
      font-family: 'Poppins', sans-serif;
      color: #f0fdf4;
      background-color: #0f172a;
      overflow-x: hidden;
    }

    h1, h2, h3, h4 { font-family: 'Playfair Display', serif; letter-spacing: 0.5px; }

    /* Dropdown animation */
    .dropdown-hidden { max-height: 0; opacity: 0; transform: translateY(-10px); overflow: hidden; transition: max-height 0.3s ease, opacity 0.3s ease, transform 0.3s ease; }
    .dropdown-visible { max-height: 500px; opacity: 1; transform: translateY(0); transition: max-height 0.3s ease, opacity 0.3s ease, transform 0.3s ease; }

    /* Nav link underline */
    .nav-link { position: relative; padding-bottom: 2px; transition: color 0.2s; letter-spacing: 0.3px; }
    .nav-link::after { content: ''; position: absolute; left: 0; bottom: 0; width: 0%; height: 2px; background-color: #979e9aff; transition: width 0.3s ease; }
    .nav-link:hover::after { width: 100%; }

    /* Rotate arrow */
    .rotate-0 { transform: rotate(0deg); transition: transform 0.3s ease; }
    .rotate-180 { transform: rotate(180deg); transition: transform 0.3s ease; }

    /* Footer links hover */
    .footer-link { position: relative; padding-bottom: 2px; transition: color 0.2s; }
    .footer-link::after { content: ''; position: absolute; left: 0; bottom: 0; width: 0%; height: 2px; background-color: #22c55e; transition: width 0.3s ease; }
    .footer-link:hover::after { width: 100%; }

    /* Mobile controls */
#mobileControls {
/* Hide mobile buttons on desktop */
@media (min-width: 768px) {
    #mobileControls {
        display: none !important;
    }
}

    display: none; /* hidden by default, will show via JS */
    position: fixed;
    bottom: 20%; /* vertically centered */
    transform: translateY(50%);
    width: 100%;
    justify-content: space-between;
    padding: 0 20px; /* distance from sides */
    z-index: 50;
    pointer-events: auto;
}

.mobile-btn {
    background-color: rgba(0,0,0,0.6);
    color: white;
    font-size: 1.2rem;
    font-weight: bold;
    padding: 20px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    user-select: none;      /* Prevent text selection */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-touch-callout: none; /* Prevent long-press menu */
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: background-color 0.2s;
}


.mobile-btn:active {
    background-color: rgba(22,163,74,0.9);
}


/* Show in all mobile orientations */


    /* Mobile canvas scaling */
    #gameCanvas { width: 100% !important; height: auto !important; max-width: 900px; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <header class="bg-gray-900 shadow-md">
    <div class="container mx-auto flex justify-between items-center py-4 px-6 relative">
      <h1 class="text-2xl font-bold text-green-400"></h1>
      <nav class="relative">
        <ul class="flex space-x-6 text-lg text-gray-300 items-center">
          <li><a href="index.html" class="nav-link">Home</a></li>

          <!-- Facts Dropdown -->
          <li class="relative">
            <button id="factsBtn" class="nav-link flex items-center focus:outline-none">
              Facts
              <svg id="factsArrow" class="ml-1 w-4 h-4 fill-current rotate-0 transition-transform" viewBox="0 0 20 20">
                <path d="M5.25 7.5l4.5 4.5 4.5-4.5H5.25z"></path>
              </svg>
            </button>
            <ul id="factsDropdown" class="absolute left-0 mt-2 w-44 bg-gray-900 rounded-md shadow-lg dropdown-hidden z-50">
              <li><a href="effects.html" class="block px-4 py-2 text-gray-300 nav-link">Effects</a></li>
              <li><a href="causes.html" class="block px-4 py-2 text-gray-300 nav-link">Causes</a></li>
              <li><a href="prevention.html" class="block px-4 py-2 text-gray-300 nav-link">Prevention</a></li>
            </ul>
          </li>

          <!-- More Dropdown -->
          <li class="relative">
            <button id="moreBtn" class="nav-link flex items-center focus:outline-none">
              More
              <svg id="moreArrow" class="ml-1 w-4 h-4 fill-current rotate-0 transition-transform" viewBox="0 0 20 20">
                <path d="M5.25 7.5l4.5 4.5 4.5-4.5H5.25z"></path>
              </svg>
            </button>
            <ul id="moreDropdown" class="absolute left-0 mt-2 w-44 bg-gray-900 rounded-md shadow-lg dropdown-hidden z-50">
              <li><a href="about.html" class="block px-4 py-2 text-gray-300 nav-link">About Us</a></li>
              <li><a href="game.html" class="block px-4 py-2 text-gray-300 nav-link">Game</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Hero -->
  <main class="min-h-screen">
    <section class="relative h-screen bg-cover bg-center" style="background-image: url('https://caltechsites-prod-assets.s3.amazonaws.com/scienceexchange/images/wind-turbine-future-energy.2e16d0ba.fill-933x525-c100.jpg');">
      <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4">
        <h1 class="text-5xl md:text-6xl text-white font-bold mb-6 aos-init aos-animate" data-aos="fade-down">
          Pollution Dodger
        </h1>
        <p class="text-lg md:text-xl text-gray-300 mb-6 max-w-2xl aos-init aos-animate" data-aos="fade-up">
          Select a level and dodge pollution to save the planet! Use ← → arrows or buttons to move. Collect seedlings to gain points!
        </p>

        <div class="flex justify-center mb-8" id="levelMenu">
          <button class="bg-gray-800 hover:bg-gray-600 text-white font-bold py-2 px-4 mx-2 rounded" onclick="startGame(1)">Level 1</button>
          <button class="bg-gray-800 hover:bg-gray-600 text-white font-bold py-2 px-4 mx-2 rounded" onclick="startGame(2)">Level 2</button>
          <button class="bg-gray-800 hover:bg-gray-600 text-white font-bold py-2 px-4 mx-2 rounded" onclick="startGame(3)">Level 3</button>
          <button class="bg-gray-800 hover:bg-gray-600 text-white font-bold py-2 px-4 mx-2 rounded" onclick="startGame(4)">Level 4</button>
          <button class="bg-gray-800 hover:bg-gray-600 text-white font-bold py-2 px-4 mx-2 rounded" onclick="startGame(5)">Level 5</button>
        </div>

        <div class="flex justify-center">
          <canvas id="gameCanvas" width="900" height="400" class="bg-gray-900 rounded-lg shadow-lg" style="display:none;"></canvas>
        </div>

        <p class="text-center mt-4 text-green-400 font-semibold" id="scoreBoard" style="display:none;">
          Score: <span id="score">0</span> | Level: <span id="level">1</span>
        </p>
      </div>
    </section>
  </main>

  <!-- Mobile Controls -->
  <div id="mobileControls">
  <button class="mobile-btn" id="leftBtn">←</button>
  <button class="mobile-btn" id="rightBtn">→</button>
</div>


  <!-- Footer -->
  <footer class="bg-gray-950 text-center py-12 mt-12 text-gray-400">
    <p class="text-gray-400">© 2025 BSIT3B Group2 | Advocates Against Climate Change</p>
  </footer>

  <!-- Scripts -->
  <script>
    AOS.init({ duration: 1000, once: true });

    const dropdowns = [
      {btn: document.getElementById('factsBtn'), menu: document.getElementById('factsDropdown'), arrow: document.getElementById('factsArrow')},
      {btn: document.getElementById('moreBtn'), menu: document.getElementById('moreDropdown'), arrow: document.getElementById('moreArrow')}
    ];

    dropdowns.forEach(d => {
      d.btn.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdowns.forEach(other => {
          if(other.menu !== d.menu) {
            other.menu.classList.remove('dropdown-visible');
            other.menu.classList.add('dropdown-hidden');
            other.arrow.classList.remove('rotate-180');
            other.arrow.classList.add('rotate-0');
          }
        });
        d.menu.classList.toggle('dropdown-visible');
        d.menu.classList.toggle('dropdown-hidden');
        d.arrow.classList.toggle('rotate-180');
        d.arrow.classList.toggle('rotate-0');
      });
    });

    window.addEventListener('click', () => {
      dropdowns.forEach(d => {
        d.menu.classList.remove('dropdown-visible');
        d.menu.classList.add('dropdown-hidden');
        d.arrow.classList.remove('rotate-180');
        d.arrow.classList.add('rotate-0');
      });
    });
  </script>

  <script>
    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Resize canvas for mobile
    function resizeCanvas() {
      const ratio = canvas.width / canvas.height;
      const width = Math.min(window.innerWidth - 20, 900);
      const height = width / ratio;
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
    }
    window.addEventListener('resize', resizeCanvas);
// Lock level buttons on load
document.addEventListener("DOMContentLoaded", () => {
    const unlocked = getUnlockedLevel();
    const buttons = document.querySelectorAll("#levelMenu button");

    buttons.forEach((btn, index) => {
        const lvl = index + 1;
        if (lvl > unlocked) {
            btn.disabled = true;
            btn.style.opacity = "0.4";
            btn.style.cursor = "not-allowed";
        }
    });
});

    const bgLayers = [new Image(), new Image(), new Image()];
    bgLayers[0].src = '/images/game/background.png';
    bgLayers[1].src = '/images/game/background2.png';
    bgLayers[2].src = '/images/game/background3.png';

    const playerImg = new Image();
    playerImg.src = '/images/game/player_spritesheet.png';
    const pollutionImgs = [new Image(), new Image()];
    pollutionImgs[0].src = '/images/game/pollution1.png';
    pollutionImgs[1].src = '/images/game/pollution2.png';
    const solarImg = new Image();
    solarImg.src = '/images/game/solar.png';

    let imagesLoaded = 0;
    function imageLoaded(){ imagesLoaded++; }
    bgLayers.forEach(img=>img.onload=imageLoaded);
    playerImg.onload = imageLoaded;
    pollutionImgs.forEach(img=>img.onload=imageLoaded);
    solarImg.onload = imageLoaded;

    // Game variables
    let player, obstacles, collectibles, score, level, gameOver, keys, bgX, currentFrame;
    let targetScore = 100;

    const collectSound = new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
    const hitSound = new Audio('https://freesound.org/data/previews/351/351624_3248244-lq.mp3');

// --- LEVEL LOCK SYSTEM ---
function refreshLevelButtons() {
    const unlocked = getUnlockedLevel();
    const buttons = document.querySelectorAll("#levelMenu button");

    buttons.forEach((btn, index) => {
        const lvl = index + 1;
        if (lvl <= unlocked) {
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.style.cursor = "pointer";
        }
    });
}

function getUnlockedLevel() {
    return parseInt(localStorage.getItem("unlockedLevel")) || 1;
}

function unlockNextLevel(level) {
    const current = getUnlockedLevel();
    if (level >= current) {
        localStorage.setItem("unlockedLevel", level + 1);
    }
}

    function startGame(selectedLevel){
    // Check if selected level is unlocked
if (selectedLevel > getUnlockedLevel()) {
    alert("Finish the previous level to unlock this one!");
    return;
}

    document.getElementById('levelMenu').style.display = 'none';
    canvas.style.display = 'block';
    document.getElementById('scoreBoard').style.display = 'block';

    // Show mobile buttons when game starts
    const mobileControls = document.getElementById('mobileControls');
    if (window.innerWidth < 768) {
    mobileControls.style.display = 'flex';
}


  player = { x: 420, y: 330, width: 60, height: 60, speed: 9, frameWidth:60, frameHeight:60 };
  obstacles = [];
  collectibles = [];
  score = 0;
  level = selectedLevel;
  gameOver = false;
  keys = {};
  bgX = [0,0,0];
  currentFrame = 0;

  targetScore = 100 + (level-1)*50;

  document.getElementById('level').innerText = level;
  document.getElementById('score').innerText = score;

  resizeCanvas(); // make sure canvas scales on start
  requestAnimationFrame(update);
}

    document.addEventListener('keydown', e => { if(keys) keys[e.key]=true; });
    document.addEventListener('keyup', e => { if(keys) keys[e.key]=false; });

    // Mobile button controls
    const mobileButtons = document.querySelectorAll('.mobile-btn');
mobileButtons.forEach(btn => {
  btn.addEventListener('touchstart', e => e.preventDefault());
});


    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    leftBtn.addEventListener('touchstart', ()=> keys['ArrowLeft']=true);
    leftBtn.addEventListener('touchend', ()=> keys['ArrowLeft']=false);
    rightBtn.addEventListener('touchstart', ()=> keys['ArrowRight']=true);
    rightBtn.addEventListener('touchend', ()=> keys['ArrowRight']=false);

    // Mobile swipe controls
    let touchStartX = 0;
    document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; });
    document.addEventListener('touchmove', e => {
      const touchX = e.touches[0].clientX;
      if(touchX < touchStartX - 20) keys['ArrowLeft'] = true;
      else keys['ArrowLeft'] = false;
      if(touchX > touchStartX + 20) keys['ArrowRight'] = true;
      else keys['ArrowRight'] = false;
    });
    document.addEventListener('touchend', e => { keys['ArrowLeft']=false; keys['ArrowRight']=false; });

    function restartGame(){
    document.getElementById('levelMenu').style.display = 'flex';
    canvas.style.display = 'none';
    document.getElementById('scoreBoard').style.display = 'none';

    // Hide mobile buttons when game ends
    document.getElementById('mobileControls').style.display = 'none';
    refreshLevelButtons();

}

    function update(){
      if(gameOver) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Parallax background
      bgLayers.forEach((bg,i)=>{
        bgX[i] -= 1 + i*level*0.3;
        if(bgX[i] <= -canvas.width) bgX[i]=0;
        ctx.drawImage(bg,bgX[i],0,canvas.width,canvas.height);
        ctx.drawImage(bg,bgX[i]+canvas.width,0,canvas.width,canvas.height);
      });

      currentFrame = (currentFrame + 0.2) % 4;
      if(keys['ArrowLeft'] && player.x>0) player.x -= player.speed;
      if(keys['ArrowRight'] && player.x+player.width<canvas.width) player.x += player.speed;

      ctx.drawImage(playerImg, Math.floor(currentFrame)*player.frameWidth, 0, player.frameWidth, player.frameHeight, player.x, player.y, player.width, player.height);

      if(Math.random() < 0.01 + level*0.005){
        const type = Math.floor(Math.random()*pollutionImgs.length);
        obstacles.push({ x: Math.random()*(canvas.width-50), y: -50, width:50, height:50, type });
      }

      if(Math.random() < 0.008){
        collectibles.push({ x: Math.random()*(canvas.width-40), y: -40, width:40, height:40 });
      }

      for(let i=obstacles.length-1;i>=0;i--){
        let o = obstacles[i];
        o.y += 3 + level*0.5;
        ctx.drawImage(pollutionImgs[o.type], o.x, o.y, o.width, o.height);
        if(o.x < player.x+player.width && o.x+o.width>player.x &&
           o.y < player.y+player.height && o.y+o.height>player.y){
          hitSound.play();
          gameOver = true;
          showGameOver();
        }
        if(o.y>canvas.height) obstacles.splice(i,1);
      }

      for(let i=collectibles.length-1;i>=0;i--){
        let c = collectibles[i];
        c.y += 2;
        ctx.drawImage(solarImg, c.x, c.y, c.width, c.height);
        if(c.x < player.x+player.width && c.x+c.width>player.x &&
           c.y < player.y+player.height && c.y+c.height>player.y){
          score += 10;
          collectSound.play();
          collectibles.splice(i,1);
        }
        if(c.y>canvas.height) collectibles.splice(i,1);
      }

      document.getElementById('score').innerText = Math.floor(score);

      if(score >= targetScore){
        gameOver = true;
        showLevelComplete();
        return;
      }

      requestAnimationFrame(update);
    }

    function showLevelComplete(){
   unlockNextLevel(level);
refreshLevelButtons(); // <--- ADD THIS


      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'lime';
      ctx.font = '50px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('LEVEL COMPLETE!', canvas.width/2, canvas.height/2 - 20);
      ctx.fillStyle = 'white';
      ctx.font = '25px Arial';
      if(level<5){
          ctx.fillText('Click to continue to next level', canvas.width/2, canvas.height/2 + 30);
      } else {
          ctx.fillText('You saved the planet! Click to restart', canvas.width/2, canvas.height/2 + 30);
      }

      canvas.addEventListener('click', function continueClick(){
          canvas.removeEventListener('click', continueClick);
          if(level<5){
              startGame(level+1);
          } else {
              restartGame();
          }
      });
    }

    function showGameOver(){
      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'red';
      ctx.font = '50px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 20);
      ctx.fillStyle = 'white';
      ctx.font = '25px Arial';
      ctx.fillText('Click to Restart', canvas.width/2, canvas.height/2 + 30);

      canvas.addEventListener('click', function restartClick(){
          canvas.removeEventListener('click', restartClick);
          restartGame();
      });
    }
  </script>

</body>
</html>
